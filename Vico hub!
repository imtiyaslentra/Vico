local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local BallFolder = Workspace:WaitForChild("Balls")

local player = Players.LocalPlayer
local canParry = false  -- Akan diubah melalui toggle
local canSpam = false   -- Akan diubah melalui toggle
local notificationCooldown = false -- Membatasi pengiriman notifikasi
local parrySuccess = false -- Menghindari spam notifikasi saat Autoparry berhasil
local spamSuccess = false -- Menghindari spam notifikasi saat Autospam berhasil

-- Membuat jendela untuk OrionLib
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()
local Window = OrionLib:MakeWindow({Name = "Vico Hub | Integrated", IntroText = "Vico Noob", HidePremium = false})

local Tab = Window:MakeTab({
	Name = "Main",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

-- Toggle untuk AutoParry
Tab:AddToggle({
    Name = "Auto Parry",
    Default = false,
    Callback = function(state)
        canParry = state
        if state then
            print("Auto Parry Enabled")
            OrionLib:MakeNotification({
                Name = "Auto Parry",
                Content = "Auto Parry has been enabled.",
                Time = 5
            })
        else
            print("Auto Parry Disabled")
            OrionLib:MakeNotification({
                Name = "Auto Parry",
                Content = "Auto Parry has been disabled.",
                Time = 5
            })
        end
    end
})

-- Toggle untuk AutoSpam
Tab:AddToggle({
    Name = "Auto Spam",
    Default = false,
    Callback = function(state)
        canSpam = state
        if state then
            print("Auto Spam Enabled")
            OrionLib:MakeNotification({
                Name = "Auto Spam",
                Content = "Auto Spam has been enabled.",
                Time = 5
            })
        else
            print("Auto Spam Disabled")
            OrionLib:MakeNotification({
                Name = "Auto Spam",
                Content = "Auto Spam has been disabled.",
                Time = 5
            })
        end
    end
})

local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local canParry = true
local canSpam = true
local parryDistance = 15 -- Jarak maksimal untuk AutoParry
local spamDistance = 10 -- Jarak untuk AutoSpam
local parrySpeedThreshold = 0.5 -- Batas kecepatan bola untuk AutoParry
local spamSpeedThreshold = 0.8 -- Batas kecepatan bola untuk AutoSpam
local notificationCooldown = 2 -- Untuk menghindari spam notifikasi

-- Variabel untuk mencegah spam notifikasi
local lastParryNotificationTime = 0
local lastSpamNotificationTime = 0

-- Fungsi untuk menghitung prediksi waktu bola mencapai pemain
local function calculatePredictionTime(ball)
    local character = player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local relativePosition = ball.Position - rootPart.Position
            local relativeVelocity = ball.Velocity

            local distance = relativePosition.Magnitude
            local speed = relativeVelocity.Magnitude

            if speed > 0 then
                return distance / speed
            end
        end
    end
    return math.huge
end

-- Fungsi untuk menampilkan notifikasi dengan cooldown
local function showNotification(message, isParry)
    local currentTime = tick()
    if isParry and currentTime - lastParryNotificationTime >= notificationCooldown then
        game.StarterGui:SetCore("SendNotification", {
            Title = "Auto Parry",
            Text = message,
            Duration = 2
        })
        lastParryNotificationTime = currentTime
    elseif not isParry and currentTime - lastSpamNotificationTime >= notificationCooldown then
        game.StarterGui:SetCore("SendNotification", {
            Title = "Auto Spam",
            Text = message,
            Duration = 2
        })
        lastSpamNotificationTime = currentTime
    end
end

-- Fungsi untuk melakukan parry
local function parry()
    if canParry then
        canParry = false
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)

        -- Jeda kecil agar tidak mengunci input terlalu lama
        task.delay(0.1, function()
            showNotification("Parry was successful!", true)
            canParry = true
        end)
    end
end

-- Fungsi untuk melakukan spam
local function spam()
    if canSpam then
        canSpam = false
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)

        -- Jeda kecil agar tidak mengunci input terlalu lama
        task.delay(0.1, function()
            showNotification("Spam was successful!", false)
            canSpam = true
        end)
    end
end

-- Fungsi untuk mengecek apakah bola berada dalam jarak parry atau spam
local function checkProximityToPlayer(ball)
    local predictionTime = calculatePredictionTime(ball)
    local character = player.Character
    local rootPart = character and character:FindFirstChild("HumanoidRootPart")

    if rootPart then
        local distanceToBall = (ball.Position - rootPart.Position).Magnitude

        -- Cek apakah bola sedang berhenti
        if ball.Velocity.Magnitude == 0 then
            showNotification("Bola berhenti, tidak ada aksi", true)
            return
        end

        -- Cek AutoParry
        if distanceToBall <= parryDistance and predictionTime <= parrySpeedThreshold then
            parry()
        -- Cek AutoSpam
        elseif distanceToBall <= spamDistance and predictionTime <= spamSpeedThreshold then
            spam()
        end
    end
end

-- Fungsi untuk memeriksa semua bola di dalam game
local function checkBallsProximity()
    for _, ball in ipairs(Workspace.Balls:GetChildren()) do
        checkProximityToPlayer(ball)
    end
end

-- Fungsi utama yang dipanggil secara berkala untuk mengecek AutoParry dan AutoSpam
RunService.Heartbeat:Connect(function()
    checkBallsProximity()
end)

OrionLib:Init()
