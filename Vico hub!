local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local BallFolder = Workspace:WaitForChild("Balls")

-- Mengambil Orion Library
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()

local player = Players.LocalPlayer
local canParry = true
local autospamEnabled = false
local autoParryEnabled = false
local ballSpeedThreshold = 10 -- Ambang kecepatan untuk AutoSpam
local parryDistanceThreshold = 10 -- Jarak maksimum untuk parry
local playerInRange = false

-- Membuat GUI
local Window = OrionLib:MakeWindow({Name = "Blade Ball Script", HidePremium = false, IntroText = "Blade Ball", OutroText = "Thank you for using!"})

-- Toggle untuk AutoParry
local autoParryToggle = Window:MakeToggle({
    Name = "Enable AutoParry",
    Default = false,
    Callback = function(value)
        autoParryEnabled = value
        print("AutoParry Enabled: " .. tostring(value)) -- Debug log
    end,
})

-- Toggle untuk AutoSpam
local autoSpamToggle = Window:MakeToggle({
    Name = "Enable AutoSpam",
    Default = false,
    Callback = function(value)
        autospamEnabled = value
        print("AutoSpam Enabled: " .. tostring(value)) -- Debug log
    end,
})

local function calculatePredictionTime(ball)
    local character = player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local relativePosition = ball.Position - rootPart.Position
            local relativeVelocity = ball.Velocity

            local distance = relativePosition.Magnitude
            local speed = relativeVelocity.Magnitude

            if speed > 0 then
                return distance / speed
            end
        end
    end
    return math.huge
end

local function parry()
    if canParry then
        canParry = false
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)

        task.delay(0.1, function()
            print("Parried successfully!")
            canParry = true
        end)
    end
end

local function checkProximityToPlayer(ball)
    local predictionTime = calculatePredictionTime(ball)
    local realBallAttribute = ball:GetAttribute("realBall")
    local target = ball:GetAttribute("target")
    
    if predictionTime and realBallAttribute and target then
        local distanceToBall = (ball.Position - player.Character.HumanoidRootPart.Position).Magnitude
        if target == player.Name and distanceToBall <= parryDistanceThreshold then
            local ballSpeedThreshold = math.max(0.4, 0.6 - ball.Velocity.Magnitude * 0.03)
            if predictionTime <= ballSpeedThreshold then
                parry()
            end
        end
    end
end

RunService.Heartbeat:Connect(function()
    if autoParryEnabled then
        for _, ball in ipairs(BallFolder:GetChildren()) do
            checkProximityToPlayer(ball)
        end
    end

    -- Cek status AutoSpam
    if autospamEnabled then
        -- Implementasikan logika AutoSpam di sini jika diperlukan
    end
end)

-- Mengatur jarak untuk mendeteksi kedekatan pemain
RunService.Heartbeat:Connect(function()
    local character = player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        for _, ball in ipairs(BallFolder:GetChildren()) do
            if ball:IsA("Ball") then
                local ballPosition = ball.Position
                local playerPosition = character.HumanoidRootPart.Position
                local distance = (ballPosition - playerPosition).Magnitude
                playerInRange = distance < parryDistanceThreshold

                if not playerInRange then
                    canParry = true -- Nonaktifkan parry jika tidak dalam jangkauan
                end
            end
        end
    end
end)

-- Menampilkan GUI
OrionLib:Init()
