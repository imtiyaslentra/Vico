-- Membuat jendela untuk OrionLib
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()
local Window = OrionLib:MakeWindow({Name = "Vico Hub | Integrated", IntroText = "Vico Noob", HidePremium = false})

local Tab = Window:MakeTab({
	Name = "Main",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

-- Toggle untuk AutoParry
Tab:AddToggle({
    Name = "Auto Parry",
    Default = false,
    Callback = function(state)
        canParry = state
        if state then
            print("Auto Parry Enabled")
            OrionLib:MakeNotification({
                Name = "Auto Parry",
                Content = "Auto Parry has been enabled.",
                Time = 5
            })
        else
            print("Auto Parry Disabled")
            OrionLib:MakeNotification({
                Name = "Auto Parry",
                Content = "Auto Parry has been disabled.",
                Time = 5
            })
        end
    end
})

-- Toggle untuk AutoSpam
Tab:AddToggle({
    Name = "Auto Spam",
    Default = false,
    Callback = function(state)
        canSpam = state
        if state then
            print("Auto Spam Enabled")
            OrionLib:MakeNotification({
                Name = "Auto Spam",
                Content = "Auto Spam has been enabled.",
                Time = 5
            })
        else
            print("Auto Spam Disabled")
            OrionLib:MakeNotification({
                Name = "Auto Spam",
                Content = "Auto Spam has been disabled.",
                Time = 5
            })
        end
    end
})

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local BallFolder = Workspace:WaitForChild("Balls")

local player = Players.LocalPlayer
local canParry = false -- Menentukan apakah AutoParry aktif
local canSpam = false -- Menentukan apakah AutoSpam aktif

-- Fungsi untuk menghitung waktu prediksi
local function calculatePredictionTime(ball)
    local character = player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local relativePosition = ball.Position - rootPart.Position
            local relativeVelocity = ball.Velocity

            local distance = relativePosition.Magnitude -- Menghitung jarak
            local speed = relativeVelocity.Magnitude -- Menghitung kecepatan

            if speed > 0 then
                return distance / speed -- Menghitung waktu prediksi
            end
        end
    end
    return math.huge -- Mengembalikan nilai besar jika tidak ada prediksi
end

-- Fungsi untuk melakukan parry
local function parry()
    if canParry then -- Memeriksa apakah parry diizinkan
        canParry = false -- Menonaktifkan sementara parry
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0) -- Mengirimkan event mouse untuk parry
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0) -- Mengirimkan event mouse untuk menyelesaikan parry

        task.delay(0.1, function()
            print("Parry successful!") -- Pesan berhasil parry
            canParry = true -- Mengaktifkan kembali parry
        end)
    end
end

-- Fungsi untuk melakukan spam
local function spam()
    if canSpam then -- Memeriksa apakah spam diizinkan
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0) -- Mengirimkan event mouse untuk spam
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0) -- Mengirimkan event mouse untuk menyelesaikan spam
        print("Spam attack!") -- Pesan saat melakukan spam
    end
end

-- Fungsi untuk mendapatkan entitas terdekat
local function get_closest_entity(Object)
    local closest_Entity
    local max_distance = math.huge
    for _, entity in Workspace.Alive:GetChildren() do
        if entity.Name ~= player.Name and entity:FindFirstChild("HumanoidRootPart") then
            local distance = (Object.Position - entity.HumanoidRootPart.Position).Magnitude
            if distance < max_distance then
                closest_Entity = entity
                max_distance = distance
            end
        end
    end
    return closest_Entity
end

-- Fungsi untuk memeriksa kedekatan bola dengan pemain untuk parry
local function checkProximityToPlayer(ball)
    local predictionTime = calculatePredictionTime(ball) -- Menghitung waktu prediksi untuk bola
    local realBallAttribute = ball:GetAttribute("realBall") -- Mendapatkan atribut nyata bola
    local target = ball:GetAttribute("target") -- Mendapatkan target bola

    if predictionTime and realBallAttribute and target then -- Memeriksa apakah semua nilai valid
        if target == player.Name then -- Memeriksa apakah target adalah pemain
            local ballSpeedThreshold = math.max(0.4, 0.6 - ball.Velocity.Magnitude * 0.03) -- Menghitung ambang kecepatan bola

            if predictionTime <= ballSpeedThreshold then -- Jika waktu prediksi lebih kecil atau sama dengan ambang
                parry() -- Melakukan parry
            end
        end
    end
end

-- Fungsi untuk memeriksa kedekatan bola dengan pemain untuk spam
local function checkProximityToSpam(ball)
    local distanceToBall = (ball.Position - player.Character.HumanoidRootPart.Position).Magnitude -- Menghitung jarak bola ke pemain
    if distanceToBall <= 10 then -- Ganti dengan jarak yang diinginkan
        spam() -- Melakukan spam
    end
end

-- Menghubungkan event heartbeat untuk memeriksa bola setiap frame
RunService.Heartbeat:Connect(function()
    for _, ball in ipairs(BallFolder:GetChildren()) do -- Iterasi semua bola dalam folder
        checkProximityToPlayer(ball) -- Memeriksa kedekatan untuk parry
        checkProximityToSpam(ball) -- Memeriksa kedekatan untuk spam
    end
end)

OrionLib:Init()
