-- Membuat jendela untuk OrionLib
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()
local Window = OrionLib:MakeWindow({Name = "Vico Hub | Integrated", IntroText = "Vico Noob", HidePremium = false})

local Tab = Window:MakeTab({
	Name = "Main",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

-- Toggle untuk AutoParry
Tab:AddToggle({
    Name = "Auto Parry",
    Default = false,
    Callback = function(state)
        canParry = state
        if state then
            print("Auto Parry Enabled")
            OrionLib:MakeNotification({
                Name = "Auto Parry",
                Content = "Auto Parry has been enabled.",
                Time = 5
            })
        else
            print("Auto Parry Disabled")
            OrionLib:MakeNotification({
                Name = "Auto Parry",
                Content = "Auto Parry has been disabled.",
                Time = 5
            })
        end
    end
})

-- Toggle untuk AutoSpam
Tab:AddToggle({
    Name = "Auto Spam",
    Default = false,
    Callback = function(state)
        canSpam = state
        if state then
            print("Auto Spam Enabled")
            OrionLib:MakeNotification({
                Name = "Auto Spam",
                Content = "Auto Spam has been enabled.",
                Time = 5
            })
        else
            print("Auto Spam Disabled")
            OrionLib:MakeNotification({
                Name = "Auto Spam",
                Content = "Auto Spam has been disabled.",
                Time = 5
            })
        end
    end
})

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local BallFolder = Workspace:WaitForChild("Balls")

local player = Players.LocalPlayer
local canParry = true
local canSpam = false
local parryDistance = 10
local spamDistance = 12
local parry_method = "Firesignal"

-- Fungsi untuk menghitung waktu prediksi kedatangan bola
local function calculatePredictionTime(ball)
    local character = player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local relativePosition = ball.Position - rootPart.Position
            local relativeVelocity = ball.Velocity

            local distance = relativePosition.Magnitude
            local speed = relativeVelocity.Magnitude

            if speed > 0 then      
                return distance / speed
            end
        end
    end
    return math.huge 
end

-- Fungsi untuk memeriksa proximity bola dengan player
local function checkProximityToPlayer(ball)
    local predictionTime = calculatePredictionTime(ball)
    local realBallAttribute = ball:GetAttribute("realBall")
    local target = ball:GetAttribute("target")
    local ballVelocity = ball.Velocity.Magnitude

    -- Jika bola adalah target pemain dan jaraknya sesuai dengan deteksi parry
    if predictionTime and realBallAttribute and target then
        if target == player.Name then
            -- Menambahkan jarak dan threshold kecepatan bola
            local ballSpeedThreshold = math.max(0.4, 0.6 - ballVelocity * 0.03)
            local rootPart = player.Character:FindFirstChild("HumanoidRootPart")
            if rootPart then
                local distance = (ball.Position - rootPart.Position).Magnitude
                
                -- Panggil AutoParry jika kondisi jarak, kecepatan, dan threshold terpenuhi
                if distance <= parryDistance and predictionTime <= ballSpeedThreshold then
                    parry()
                end
            end
        end
    end
end

-- Fungsi AutoParry
local function parry()
    if canParry then
        canParry = false
        -- Jeda singkat untuk memastikan input mouse tidak mengganggu pergerakan
        task.spawn(function()
            task.wait(0.05) -- Jeda sangat singkat (50ms) sebelum mengirim input mouse
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
            
            print("Auto Parry Successful")
            canParry = true -- Aktifkan kembali AutoParry setelah jeda
        end)
    end
end

-- Fungsi AutoSpam
local function autoSpam(ball)
    local character = player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local distance = (ball.Position - rootPart.Position).Magnitude

            -- AutoSpam jika jarak dengan bola memenuhi syarat
            if distance <= spamDistance and canSpam then
                VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
                VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
                print("Auto Spam Activated")
            end
        end
    end
end

-- Monitor bola dan aktifkan fungsi
RunService.Heartbeat:Connect(function()
    for _, ball in pairs(BallFolder:GetChildren()) do
        if ball:IsA("Part") and ball:FindFirstChild("Velocity") then
            checkProximityToPlayer(ball)
            autoSpam(ball)
        end
    end
end).

-- Penanganan notifikasi jika gagal atau berhasil
local function notifyResult(success, reason)
    if success then
        print("Parry/Spam was Successful!")
    else
        print("Failed due to: " .. reason)
    end
end

OriobLib:Init()
