-- Inisialisasi OrionLib
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()

if not OrionLib then
    error("Failed to load OrionLib")
end

-- Membuat jendela
local Window = OrionLib:MakeWindow({
    Name = "Vico Hub | Integrated ",
    IntroText = "Vico Noob",
    HidePremium = false
})

local Tab = Window:MakeTab({
    Name = "Main",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Variabel untuk menyimpan status
local canParry = false
local AutoWalk = false
local PlayerSafety = false
local BaseDistance = 0

-- Toggle untuk Auto Parry
Tab:AddToggle({
    Name = "Auto Parry",
    Default = false,
    Callback = function(state)
        canParry = state  -- Perbaikan: ganti 'State' menjadi 'state'
        if state then     -- Perbaikan: ganti 'Value' menjadi 'state'
            print("Auto Parry Enabled")
        else
            print("Auto Parry Disabled")
        end
    end    
})

-- Toggle untuk AutoSpam
Tab:AddToggle({
    Name = "Auto Spam",
    Default = false,
    Callback = function(state)
        canSpam = state
        if canSpam then
            print("Auto Spam Enabled")
        else
            print("Auto Spam Disabled")
        end
    end    
})

-- Toggle untuk Auto Walk
Tab:AddToggle({
    Name = "Auto Walk",
    Default = false,
    Callback = function(state)
        AutoWalk = state
        if AutoWalk then
            print("Auto Walk Enabled")
        else
            print("Auto Walk Disabled")
        end
    end
})

-- Slider untuk Parry Base Distance
Tab:AddSlider({
    Name = "Parry Base Distance",
    Min = 0,
    Max = 100,
    Default = 0,
    Callback = function(value)  -- Menggunakan 'value' di sini
        BaseDistance = value
        print("Base Distance set to: " .. BaseDistance)
    end
})

-- Toggle untuk Player Safety
Tab:AddToggle({
    Name = "Player Safety",
    Default = false,
    Callback = function(state)
        PlayerSafety = state
        if PlayerSafety then
            print("Player Safety Enabled")
        else
            print("Player Safety Disabled")
        end
    end
})

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local BallFolder = Workspace:WaitForChild("Balls")

local player = Players.LocalPlayer
local canParry = true
local canSpam = false
local Titan_blade = false
local Predict_parry = true
local Parry_mode = "pro hard"
local parry_method = "Firesignal"
local config_1 = BallFolder()
local config_2 = SpamFolder()
local calculate_1_2 = true
local autofarm = false
local ai_play = false
local ai_farm_rage = false
local no_delay = false
local ai_chat = false
local afk_mode = false
local idgaf_mode = true
local skid_fade = false
if idgaf_mode then
    local skid_fade = true
    local skid_pastebin = true
end

-- Perhitungan waktu prediksi bola untuk AutoParry
local function calculatePredictionTime(ball)
    local character = player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local relativePosition = ball.Position - rootPart.Position
            local relativeVelocity = ball.Velocity

            local distance = relativePosition.Magnitude
            local speed = relativeVelocity.Magnitude

            if speed > 0 then
                return distance / speed
            end
        end
    end
    return math.huge 
end

-- Fungsi AutoParry
local function parry()
    if canParry then
        canParry = false
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
        
        task.delay(0.1, function()
            print("Parried successfully")
            canParry = true
        end)
    end
end

-- Fungsi AutoSpam
local function spam()
    if canSpam then
        canSpam = false
        -- Simulasi input untuk spam
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Space, false, game)
        task.wait(0.05)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Space, false, game)

        -- Cooldown sebelum bisa spam lagi
        task.delay(0.2, function()
            print("Spam action triggered")
            canSpam = true
        end)
    end
end

-- Memeriksa jarak bola dari pemain
local function checkProximityToPlayer(ball)
    local predictionTime = calculatePredictionTime(ball)
    local realBallAttribute = ball:GetAttribute("realBall")
    local target = ball:GetAttribute("target")

    if predictionTime and realBallAttribute and target then
        if target == player.Name then
            local ballSpeedThreshold = math.max(0.4, 0.6 - ball.Velocity.Magnitude * 0.03)

            -- Kondisi untuk AutoParry
            if predictionTime <= ballSpeedThreshold then
                parry()
            end

            -- Kondisi untuk AutoSpam (misalnya jika bola melambat atau berhenti)
            if ball.Velocity.Magnitude < 5 then
                spam()
            end
        end
    end
end

-- Anti kurve untuk AutoSpam
local function antiCurve(ball)
    if ball.Velocity.Magnitude > 10 then
        local curve = ball.RotVelocity.Magnitude
        if curve > 5 then
            -- Deteksi kurva dan spam untuk melawan efek kurva
            spam()
        end
    end
end

-- Fungsi utama untuk memeriksa proximity dan anti kurve
local function checkBallsProximity()
    for _, ball in pairs(BallFolder:GetChildren()) do
        checkProximityToPlayer(ball)
        antiCurve(ball)
    end
end

-- Koneksi fungsi ke RunService
RunService.Heartbeat:Connect(function()
    checkBallsProximity()
end)

OrionLib:Init()
